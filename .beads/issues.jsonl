{"id":"llmring-1ga","title":"Clarify/implement runtime fallback across alias model pools","description":"Docs claim automatic failover across the full model pool for an alias (rate limits/outages), but AliasResolver.resolve only selects the first model whose provider has an API key; LLMRing.chat does not retry through Lockfile.resolve_alias(...) on provider errors. Either implement retry+fallback behavior or narrow docs to “provider-availability selection”.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-02T18:25:07.558838Z","created_by":"juanre","updated_at":"2026-01-02T21:51:03.672022Z","closed_at":"2026-01-02T21:51:03.672022Z","close_reason":"Implemented real runtime failover across alias model pools: LLMRing.chat retries next candidate on provider/model errors; chat_stream retries before first chunk. Added non-mocking unit tests."}
{"id":"llmring-1iy","title":"Fix pyright warnings in MCP info_service","description":"pyright passes (0 errors) but reports two reportUnusedExpression warnings in src/llmring/mcp/client/info_service.py (around lines 541 and 600). Remove/replace the stray expression statements to get to 0 warnings without behavior change.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T20:53:18.932963Z","created_by":"juanre","updated_at":"2026-01-02T21:23:17.044682Z","closed_at":"2026-01-02T21:23:17.044682Z","close_reason":"Removed two stray unused datetime expressions; pyright now reports 0 warnings.","dependencies":[{"issue_id":"llmring-1iy","depends_on_id":"llmring-yww","type":"discovered-from","created_at":"2026-01-02T20:53:18.933794Z","created_by":"juanre"}]}
{"id":"llmring-1lq","title":"Sync docs with code: StreamChunk fields, provider interface, and LLMRingSession naming","description":"Docs/README/ADRs use StreamChunk.content and describe protocol-based providers + LLMRingExtended as primary; code uses StreamChunk.delta, providers subclass BaseLLMProvider (ABC), and LLMRingExtended is a compatibility alias for LLMRingSession (src/llmring/service_extended.py). Update docs/examples and/or provide backwards-compatible aliases.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T18:25:02.826558Z","created_by":"juanre","updated_at":"2026-01-02T21:21:18.481982Z","closed_at":"2026-01-02T21:21:18.481982Z","close_reason":"Synced docs/examples with current APIs (StreamChunk.delta, BaseLLMProvider ABC interface, LLMRingSession, MCP streaming)."}
{"id":"llmring-35h","title":"Fix version mismatch: pyproject vs llmring.__version__","description":"pyproject.toml sets version to 1.3.0, but src/llmring/__init__.py sets __version__ = \"1.2.0\"; unify to a single source of truth so runtime and packaging metadata agree.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-02T18:25:00.24681Z","created_by":"juanre","updated_at":"2026-01-02T20:54:04.311601Z","closed_at":"2026-01-02T20:54:04.311601Z","close_reason":"Runtime version now sourced from package metadata via importlib.metadata.version (no hardcoded mismatch)"}
{"id":"llmring-4kn","title":"Lockfile composability with namespaced aliases","description":"Enable libraries to ship lockfiles that consumers can extend and override using namespaced aliases.\n\n## Design\n\n**Consumer's lockfile:**\n```toml\n[extends]\npackages = [\"libA\", \"libB\"]\n\n# Optional: override libA's alias\n[[profiles.default.bindings]]\nalias = \"libA:summarizer\"\nmodels = [\"openai:gpt-4o-mini\"]\n```\n\n**Consumer's code:**\n```python\n# Explicit: using libA's alias (possibly overridden)\nring.chat(\"libA:summarizer\", messages=[...])\n\n# Unqualified: local only\nring.chat(\"summarizer\", messages=[...])\n```\n\n## Resolution Rules\n1. `libA:summarizer` → check consumer lockfile for `libA:summarizer`, else check libA's lockfile for `summarizer`\n2. `summarizer` (unqualified) → consumer lockfile only\n\n## Discovery\nUse importlib.resources to find package location, convention `\u003cpackage\u003e/llmring.lock` for filename.","status":"in_progress","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-23T11:49:58.03971+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T12:00:08.664421+01:00","labels":["epic"]}
{"id":"llmring-4kn.1","title":"Parse [extends] section in lockfile","description":"Add parsing for new [extends] section in lockfile TOML:\n\n```toml\n[extends]\npackages = [\"libA\", \"libB\"]  # Package names\n# Future: paths = [\"./vendor/lib/llmring.lock\"]  # Explicit paths\n```\n\n## Files to modify\n- `src/llmring/lockfile_core.py`: Add `extends` field to Lockfile model (Pydantic)\n- `src/llmring/lockfile_core.py`: Update `Lockfile.load()` to parse [extends] section\n\n## Acceptance criteria\n- [ ] Lockfile model has `extends: Optional[ExtendsConfig]` field\n- [ ] ExtendsConfig model has `packages: List[str]` field\n- [ ] load() parses [extends] without error\n- [ ] Missing [extends] section defaults to empty list\n- [ ] Invalid package names raise ValidationError\n\n## Example\n```python\nlockfile = Lockfile.load(\"llmring.lock\")\nprint(lockfile.extends.packages)  # [\"libA\", \"libB\"]\n```","status":"in_progress","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-23T11:50:06.71663+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T12:00:08.743463+01:00","dependencies":[{"issue_id":"llmring-4kn.1","depends_on_id":"llmring-4kn","type":"parent-child","created_at":"2026-01-23T11:50:06.718125+01:00","created_by":"Juan Reyero"}]}
{"id":"llmring-4kn.2","title":"Implement package lockfile discovery via importlib","description":"Implement function to discover lockfile from installed package.\n\n## Files to modify\n- `src/llmring/lockfile_core.py`: Add `discover_package_lockfile()` function\n\n## Implementation\n```python\ndef discover_package_lockfile(package_name: str) -\u003e Path | None:\n    \"\"\"Find llmring.lock in an installed package.\n    \n    Uses importlib.resources to locate the package, then looks for\n    llmring.lock in the package root directory.\n    \n    Returns None if package not found or has no lockfile.\n    \"\"\"\n    from importlib.resources import files, as_file\n    try:\n        package_files = files(package_name)\n        lockfile_traversable = package_files / \"llmring.lock\"\n        # Need to materialize to check if it exists\n        with as_file(lockfile_traversable) as lockfile_path:\n            if lockfile_path.exists():\n                return lockfile_path\n    except (ModuleNotFoundError, TypeError, FileNotFoundError):\n        pass\n    return None\n```\n\n## Acceptance criteria\n- [ ] Returns Path when package has llmring.lock\n- [ ] Returns None when package not installed\n- [ ] Returns None when package has no llmring.lock\n- [ ] Works with packages installed via pip/uv\n- [ ] Works with editable installs (pip install -e)\n- [ ] Handles namespace packages correctly\n\n## Edge cases\n- Package installed but no llmring.lock → None\n- Package not installed → None  \n- Package name typo → None (no error thrown)","status":"open","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-23T11:50:14.314092+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T11:53:54.537544+01:00","dependencies":[{"issue_id":"llmring-4kn.2","depends_on_id":"llmring-4kn","type":"parent-child","created_at":"2026-01-23T11:50:14.315237+01:00","created_by":"Juan Reyero"}]}
{"id":"llmring-4kn.3","title":"Implement namespaced alias resolution","description":"Update AliasResolver to handle namespaced aliases like `libA:summarizer`.\n\n## Prerequisites\n- llmring-4kn.1 (parse [extends])\n- llmring-4kn.2 (discover_package_lockfile)\n\n## Files to modify\n- `src/llmring/alias_resolver.py`: Update `resolve_alias()` method\n- `src/llmring/alias_resolver.py`: Add `_parse_namespaced_alias()` helper\n- `src/llmring/alias_resolver.py`: Add `_extended_lockfiles` cache\n\n## Resolution logic\n1. Parse alias: `_parse_namespaced_alias(\"libA:summarizer\")\" → (\"libA\", \"summarizer\")\n2. If namespaced:\n   a. Check consumer lockfile for exact match `libA:summarizer` (override)\n   b. If not found, load libA's lockfile via discover_package_lockfile()\n   c. Resolve `summarizer` in libA's lockfile\n3. If unqualified:\n   a. Consumer lockfile only (never check extended)\n\n## Acceptance criteria\n- [ ] `libA:summarizer` resolves from libA's lockfile\n- [ ] Consumer can override with `alias = \"libA:summarizer\"` in their lockfile\n- [ ] Unqualified `summarizer` only checks consumer lockfile\n- [ ] Extended lockfiles are cached (not reloaded on every resolve)\n- [ ] Clear error if package not in [extends]\n- [ ] Clear error if alias not found in package lockfile\n\n## Error messages\n```\nAliasNotFoundError: Alias 'libA:summarizer' not found.\n  Package 'libA' is in [extends] but its lockfile has no 'summarizer' alias.\n  Available aliases in libA: analyzer, embedder\n```\n\n```\nAliasNotFoundError: Cannot resolve 'libA:summarizer'.\n  Package 'libA' is not listed in [extends].packages.\n  Add it to your lockfile: [extends] packages = [\"libA\"]\n```","status":"open","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-23T11:50:22.656026+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T11:54:07.609239+01:00","dependencies":[{"issue_id":"llmring-4kn.3","depends_on_id":"llmring-4kn","type":"parent-child","created_at":"2026-01-23T11:50:22.656871+01:00","created_by":"Juan Reyero"}]}
{"id":"llmring-4kn.4","title":"Update require_aliases for namespaced aliases","description":"Update `require_aliases()` to support namespaced aliases.\n\n## Prerequisites\n- llmring-4kn.3 (namespaced resolution)\n\n## Files to modify\n- `src/llmring/lockfile_core.py`: Update `require_aliases()` method\n\n## Implementation\n```python\ndef require_aliases(\n    self, \n    required: List[str],\n    profile: Optional[str] = None,\n    context: Optional[str] = None\n) -\u003e None:\n    \"\"\"Validate required aliases exist. Supports namespaced aliases.\"\"\"\n    missing = []\n    for alias in required:\n        try:\n            self.resolve_alias(alias, profile=profile)\n        except AliasNotFoundError:\n            missing.append(alias)\n    \n    if missing:\n        # Build helpful error message\n        raise ValueError(...)\n```\n\n## Acceptance criteria\n- [ ] Works with unqualified aliases: `require_aliases([\"summarizer\"])`\n- [ ] Works with namespaced aliases: `require_aliases([\"libA:summarizer\"])`\n- [ ] Works with mixed: `require_aliases([\"local\", \"libA:remote\"])`\n- [ ] Error message lists all missing aliases\n- [ ] Error message shows which lockfile was checked for each\n\n## Error message example\n```\nValueError: Missing required aliases for my-library (profile: default):\n  - summarizer: not found in consumer lockfile\n  - libA:analyzer: not found in libA lockfile (libA has: embedder, chat)\nLockfile path: /path/to/llmring.lock\n```","status":"open","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-23T11:50:29.901865+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T11:54:18.200974+01:00","dependencies":[{"issue_id":"llmring-4kn.4","depends_on_id":"llmring-4kn","type":"parent-child","created_at":"2026-01-23T11:50:29.90259+01:00","created_by":"Juan Reyero"}]}
{"id":"llmring-4kn.5","title":"CLI: llmring lock check for extends validation","description":"Add CLI validation command for extended lockfiles.\n\n## Prerequisites\n- llmring-4kn.1, .2, .3 (core functionality)\n\n## Files to modify\n- `src/llmring/cli/lock.py`: Add `check` subcommand\n\n## Command\n```bash\nllmring lock check [--lockfile PATH]\n```\n\n## Checks performed\n1. Parse [extends] section\n2. For each package in extends:\n   - Check package is installed\n   - Check package has llmring.lock\n   - Load and validate lockfile\n   - List aliases found\n3. Warn on alias conflicts (same alias in multiple packages)\n4. Summary of all available aliases\n\n## Output format\n```\nChecking lockfile: ./llmring.lock\n\n[extends]\n  ✓ libA: found llmring.lock\n    Aliases: summarizer, analyzer, embedder\n  ✓ libB: found llmring.lock\n    Aliases: translator, chat\n  ✗ libC: package not installed\n\nWarnings:\n  ⚠ 'summarizer' defined in both libA and libB\n    Use libA:summarizer or libB:summarizer to disambiguate\n\nLocal aliases:\n  myalias → anthropic:claude-sonnet-4-20250514\n\nSummary: 2/3 packages OK, 6 extended aliases, 1 local alias\n```\n\n## Exit codes\n- 0: All OK\n- 1: Missing packages or lockfiles\n- 2: Lockfile parse error\n\n## Acceptance criteria\n- [ ] Lists all extended packages and their aliases\n- [ ] Warns on conflicts\n- [ ] Fails if package not installed\n- [ ] Fails if package has no lockfile\n- [ ] Works with --lockfile flag for non-default paths","status":"open","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-23T11:50:37.560592+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T11:54:31.511515+01:00","dependencies":[{"issue_id":"llmring-4kn.5","depends_on_id":"llmring-4kn","type":"parent-child","created_at":"2026-01-23T11:50:37.561866+01:00","created_by":"Juan Reyero"}]}
{"id":"llmring-4kn.6","title":"Documentation: Library authors guide for lockfile composability","description":"Document lockfile composability for library authors and consumers.\n\n## Prerequisites\n- All implementation beads complete\n\n## Files to modify\n- `docs/lockfile.md`: Add 'Composability' section\n- `skills/lockfile/SKILL.md`: Update library patterns section\n- `README.md`: Add example to quick start\n\n## Documentation outline\n\n### For library authors (docs/lockfile.md)\n1. **Shipping a lockfile**\n   - Place llmring.lock in package root\n   - Include in package_data/MANIFEST.in\n   \n2. **Declaring required aliases**\n   ```python\n   ring.require_aliases([\"summarizer\"], context=\"my-library\")\n   ```\n\n3. **Allowing overrides**\n   - Accept lockfile_path parameter\n   - Document which aliases your library needs\n\n4. **Alias naming best practices**\n   - Avoid generic names (summarizer → mylib_summarizer)\n   - Or rely on namespacing (consumers use mylib:summarizer)\n\n### For consumers (docs/lockfile.md)\n1. **Extending library lockfiles**\n   ```toml\n   [extends]\n   packages = [\"libA\", \"libB\"]\n   ```\n\n2. **Using namespaced aliases**\n   ```python\n   ring.chat(\"libA:summarizer\", ...)\n   ```\n\n3. **Overriding library aliases**\n   ```toml\n   [[profiles.default.bindings]]\n   alias = \"libA:summarizer\"\n   models = [\"openai:gpt-4o-mini\"]\n   ```\n\n4. **Validating setup**\n   ```bash\n   llmring lock check\n   ```\n\n## Acceptance criteria\n- [ ] Library author guide with complete example\n- [ ] Consumer guide with complete example\n- [ ] SKILL.md updated with new patterns\n- [ ] README has minimal example\n- [ ] All code examples tested","status":"open","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-23T11:50:45.62768+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T11:54:44.634865+01:00","dependencies":[{"issue_id":"llmring-4kn.6","depends_on_id":"llmring-4kn","type":"parent-child","created_at":"2026-01-23T11:50:45.628402+01:00","created_by":"Juan Reyero"}]}
{"id":"llmring-4kn.7","title":"Tests for lockfile composability","description":"Comprehensive tests for lockfile composability.\n\n## Prerequisites\n- Run in parallel with implementation (TDD)\n\n## Files to create/modify\n- `tests/test_lockfile_extends.py`: New test file\n- `tests/fixtures/fake_packages/`: Test package fixtures\n\n## Test fixtures needed\nCreate fake packages for testing:\n```\ntests/fixtures/fake_packages/\n├── libA/\n│   ├── __init__.py\n│   └── llmring.lock  # has: summarizer, analyzer\n├── libB/\n│   ├── __init__.py\n│   └── llmring.lock  # has: translator, summarizer (conflict)\n└── libC/\n    └── __init__.py   # no lockfile\n```\n\n## Unit tests\n\n### test_parse_extends_section\n- Empty [extends] → empty list\n- Single package → [\"libA\"]\n- Multiple packages → [\"libA\", \"libB\"]\n- Missing section → None/empty\n\n### test_discover_package_lockfile\n- Package with lockfile → returns Path\n- Package without lockfile → returns None\n- Package not installed → returns None\n- Editable install → returns Path\n\n### test_namespaced_alias_resolution\n- `libA:summarizer` → resolves from libA\n- `libA:summarizer` with consumer override → uses override\n- `summarizer` (unqualified) → consumer only\n- `libA:nonexistent` → AliasNotFoundError\n- `notinextends:alias` → error about missing extends\n\n### test_require_aliases_namespaced\n- All found → passes\n- Missing namespaced → fails with details\n- Mixed local and namespaced → works\n\n## Integration tests\n\n### test_full_resolution_chain\n- Consumer extends libA, libB\n- Override libA:summarizer\n- Resolve various aliases\n- Verify correct models returned\n\n### test_cli_lock_check\n- Happy path → exit 0\n- Missing package → exit 1\n- Conflict warning → exit 0 with warning\n\n## Edge case tests\n- Circular extends (A extends B extends A) → error\n- Package in extends but not installed → clear error\n- Same alias in multiple packages → resolution order / warning\n\n## Acceptance criteria\n- [ ] \u003e90% coverage on new code\n- [ ] All edge cases covered\n- [ ] Tests run in \u003c10s\n- [ ] No flaky tests","status":"open","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-23T11:50:53.188781+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T11:55:00.48702+01:00","dependencies":[{"issue_id":"llmring-4kn.7","depends_on_id":"llmring-4kn","type":"parent-child","created_at":"2026-01-23T11:50:53.189508+01:00","created_by":"Juan Reyero"}]}
{"id":"llmring-5sw","title":"Fix ruff E402/import-order failures (duplicate module docstrings)","description":"Ruff currently fails with hundreds of E402 errors because many modules have a second top-level string literal (duplicate module docstring) before imports (e.g. src/llmring/service.py, src/llmring/services/alias_resolver.py, src/llmring/providers/openai_api.py). Remove redundant literals so imports are immediately after the single module docstring, then re-run ruff check/format.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-02T18:24:39.757829Z","created_by":"juanre","updated_at":"2026-01-02T19:18:15.903453Z","closed_at":"2026-01-02T19:18:15.903453Z","close_reason":"Ruff check/format clean; unit tests pass"}
{"id":"llmring-86p","title":"Fix bdh auto-reserve failing with \u003e50 paths","description":"bdh auto-reserve frequently fails with HTTP 422 because it tries to reserve more than 50 paths (server-side limit). This prevents proper file reservation/coordination. Fix by batching reservations (\u003c=50) or narrowing tracked paths for large changes.","status":"open","priority":2,"issue_type":"chore","created_at":"2026-01-02T20:53:18.361373Z","created_by":"juanre","updated_at":"2026-01-02T20:53:27.777099Z","dependencies":[{"issue_id":"llmring-86p","depends_on_id":"llmring-yww","type":"discovered-from","created_at":"2026-01-02T20:53:18.36271Z","created_by":"juanre"}]}
{"id":"llmring-cub","title":"Remove mocks/TODOs from tests to match project policy","description":"Project policy says never mock in tests + do not leave TODO tracking in code, but many tests import unittest.mock/AsyncMock and there are TODO comments (e.g. tests/test_usage_logging.py, tests/test_logging_decorators.py, tests/unit/test_alias_resolver.py, tests/mcp/server/test_stdio_transport.py). Replace with real integration-style tests and move TODOs into BeadHub issues.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T18:25:05.331608Z","created_by":"juanre","updated_at":"2026-01-02T18:26:35.060309Z"}
{"id":"llmring-kci","title":"Fix registry URL validation: localhost HTTP allowed vs blocked","description":"InputValidator.validate_registry_url says HTTP is allowed for localhost/test domains, but later blocks localhost/127.0.0.1 as dangerous hostnames; this prevents local registry development unless using file://. Decide desired security policy and make logic consistent.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T18:25:09.465822Z","created_by":"juanre","updated_at":"2026-01-02T21:30:35.546366Z","closed_at":"2026-01-02T21:30:35.546366Z","close_reason":"Made validate_registry_url consistent: allow http for localhost/loopback and test domains; reject unspecified IPs; warn (not block) private/link-local; added unit tests."}
{"id":"llmring-wf9","title":"Investigate OpenAI PDF ingestion failing integration test","description":"Integration suite currently fails tests/integration/test_file_processing.py::TestFileProcessing::test_pdf_processing_openai: model responds it cannot read PDFs, suggesting the PDF payload is not being delivered or the wrong API path is used. Confirm analyze_file output format + OpenAI provider PDF handling (Assistants/Responses) and make test deterministic.","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-02T18:26:45.186821Z","created_by":"juanre","updated_at":"2026-01-02T18:26:45.186821Z"}
{"id":"llmring-yww","title":"Fix pyright typecheck failures (CI gate)","description":"CI runs `uv run pyright src/llmring/` and it currently reports hundreds of errors (timeout sentinel typing, BaseLLMProvider missing methods used by service, dict-vs-str assumptions in CLI/server commands, Optional handling). Fix core typings so pyright passes.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-02T18:32:40.572329Z","created_by":"juanre","updated_at":"2026-01-02T20:52:43.447493Z","closed_at":"2026-01-02T20:52:43.447493Z","close_reason":"Pyright passes (0 errors), ruff clean, unit tests passing"}
